
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/MasterAdmin.cshtml";
    var lst = ViewBag.lstSP;
}
<style>
    .btn-primary {
        margin-top: 10px;
    }
</style>
<div class="container">
    <h2>Tổng sản phẩm là: @lst.Count</h2>
    <table class="table table-bordered" id="tbProduct">
        <thead>
            <tr>
                <th>
                    Mã
                </th>
                <th>
                    Tên
                </th>
                <th>
                    Chi tiết
                </th>
                <th>
                    Giá
                </th>
                <th class="text-center">
                    Chức Năng
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in lst)
            {
                <tr>
                    <td>@item.ID</td>
                    <td style="width:25%">@item.ProductName</td>
                    <td style="width:25%">@item.Details</td>
                    <td>@item.Prices</td>
                    <td class="text-center">
                        <button type="button" style="width:40%" class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="myFunction(@item.ID,'@item.ProductName','@item.Details',@item.Prices)">Update</button>
                        <button type="button" style="width:40%" class="btn btn-primary" data-toggle="modal" data-target="#myModalDelete" onclick="myFunctionDelete(@item.ID,'@item.ProductName','@item.Details',@item.Prices)">Delete</button>
                        <button type="button" style="width:40%" class="btn btn-primary" data-toggle="modal" data-target="#myModalImage" onclick="myFunction(@item.ID,'@item.ProductName','@item.Details',@item.Prices)">UpLoadImage</button>

                    </td>
                </tr>
            }
        </tbody>
        <tfoot class="table-secondary">
            <tr>
                <td colspan=" 5" class="text-center">
                    <button type="button" style="width:40%" class="btn btn-primary" data-toggle="modal" data-target="#myModalInsert">Insert</button>
                </td>
            </tr>
        </tfoot>
    </table>
    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Modal Header</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="frmInput">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="IDSP" type="number" class="form-control" name="ID" placeholder="ID">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="Name" type="text" class="form-control" name="Name" placeholder="Name">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="Detail" type="text" class="form-control" name="Detail" placeholder="Detail">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="Price" type="number" class="form-control" name="Price" placeholder="price">
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" onclick="save()">Lưu</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModalInsert" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Modal Header</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="frmInputInsert">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="IDSP" type="number" class="form-control" name="id" placeholder="ID">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="Name" type="text" class="form-control" name="Name" placeholder="Name">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <select id="opCate" class="form-control" onchange="run()">
                                <option value="0">Chọn loại đồ</option>
                                <option value="1">ÁO</option>
                                <option value="2">QUẦN</option>
                                <option value="3">GIÀY</option>
                            </select>
                            <input id="idCategory" type="text" class="form-control" name="idCategory" placeholder="idCategory">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="Detail" type="text" class="form-control" name="Detail" placeholder="Detail">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="Price" type="number" class="form-control" name="Price" placeholder="price">
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" onclick="insert()">Thêm</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModalDelete" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Modal Header</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="frmInputDelete">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="IDSPDelete" type="number" class="form-control" name="ID" placeholder="ID">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="NameDelete" type="text" class="form-control" name="Name" placeholder="Name">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="DetailDelete" type="text" class="form-control" name="Detail" placeholder="Detail">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="PriceDelete" type="number" class="form-control" name="Price" placeholder="price">
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" onclick="Xoa()">Xóa</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Image -->
    <div class="modal fade" id="myModalImage" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Modal Header</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <label>Upload Image</label>
                    <div class="input-group">
                        <input type="file" id="imageUploadForm" name="image" multiple="multiple">
                    </div>
                    <img id='img-upload' />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function run() {
        var selObj = document.getElementById("opCate");
        var selValue = selObj.options[selObj.selectedIndex].value;
        if (selValue > 0)
        {
            //Setting Value
            document.getElementById("idCategory").value = selValue;
            selObj.removeChild(selObj.options[0]);
        }
        else
            document.getElementById("idCategory").value = "";
    }
    function myFunction(id, name, detail,price) {
        document.getElementById("IDSP").value = id;
        document.getElementById("Name").value = name;
        document.getElementById("Detail").value = detail;
        document.getElementById("Price").value = price;
        return;
    }
    function myFunctionDelete(id, name, detail, price) {
        document.getElementById("IDSPDelete").value = id;
        document.getElementById("NameDelete").value = name;
        document.getElementById("DetailDelete").value = detail;
        document.getElementById("PriceDelete").value = price;
        return;
    }
    function insert() {
        var fd = new FormData(document.getElementById("frmInputInsert"));
        // fd.append('file', input.files[0]);
        $.ajax({
            url: '/ProductAD/Insert',
            data: fd,
            processData: false,
            contentType: false,
            type: 'POST',
            success: function (data) {
                $('#myModalInsert').modal('hide');
            }
        });
    }
    function save() {
        var fd = new FormData(document.getElementById("frmInput"));
        // fd.append('file', input.files[0]);
        var dt=document.getElementById("opCate");
        var selectValue=dt.options[dt.selectedIndex].value;
        $.ajax({
            url: '/ProductAD/Save',
            data: fd,
            processData: false,
            contentType: false,
            type: 'POST',
            success: function (data) {
                $('#myModal').modal('hide');
            }
        });
    }
    function Xoa() {
        var fd = new FormData(document.getElementById("frmInputDelete"));
        // fd.append('file', input.files[0]);
        $.ajax({
            url: '/ProductAD/Delete',
            data: fd,
            processData: false,
            contentType: false,
            type: 'POST',
            success: function (data) {
                //alert(data);
                $('#myModalDelete').modal('hide');
            }
        });
    }
    $(document).ready(function() {
        $('#tbProduct').DataTable();
    } );
    $(document).ready(function(){
        // convert selects already on the page at dom load
        $('select.form-control').combobox();

        $('#it').click(function(e){
            $('ul.dropdown-menu').toggle();
        });
    });
    $(document).ready(function () {
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#img-upload').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        $("#imageUploadForm").change(function () {
            readURL(this);
        });
    });
</script>

